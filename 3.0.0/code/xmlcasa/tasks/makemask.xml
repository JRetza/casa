<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
      file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="makemask" category="imaging">
	<shortdescription>Make a mask image from rectangular boxes</shortdescription>
	<description>
	</description>
	<input>

    <param type="any" name="cleanbox">
	    <description>clean box regions or file name or \'interactive\'</description>
	    <any type="variant"/>
	    <value type="record"/>
    </param>
		<param type="string" name="vis" mustexist="true">
			<description>Name of input visibility file (MS)</description>
			<value></value>
		</param>

		<param type="string" name="imagename">
			<description></description>
			<value></value>
		</param>

    <param type="string" name="mode">
	    <description>Type of selection (mfs, channel, velocity, frequency)</description>
	    <allowed kind="enum">
	    <value>mfs</value>
	    <value>channel</value>
	    <value>velocity</value>
	    <value>frequency</value>
    </allowed>
    </param>


    <param type="any" name="nchan" subparam="true">
	    <description>Number of channels (planes) in output image</description>
	    <any type="variant"/>
	    <value type="int">1</value>
    </param>

    <param type="any" name="start" subparam="true">
	    <description>First channel in input to use</description>
	    <any type="variant"/>
	    <value type="int">0</value>
    </param>

    <param type="any" name="width" subparam="true">
	    <description>Number of input channels to average</description>
	    <any type="variant"/>
	    <value type="int">1</value>
	    <allowed range="min"><value>1</value></allowed>
    </param>


    <param type="intArray" name="imsize">
	    <description>x and y image size in pixels, symmetric for single value</description>
	    <value type="vector">
    <value>256</value><value>256</value>
	    </value>
    </param>

    <param type="doubleArray" name="cell" units="arcsec">
    <description>x and y cell size. default unit radians</description>
    <value type="vector"><value>1.0</value><value>1.0</value></value>
    </param>

    <param type="any" name="phasecenter">
	    <description>Image phase center: position or field index</description>
	    <any type="variant"/>
	    <value type="string"></value>
    </param>

    <param type="string" name="stokes">
	    <description>Stokes params to image (eg I,IV, QU,IQUV)</description>
	    <value>I</value>
    <allowed kind="enum">
	    <value>I</value>
	    <value>IV</value>
	    <value>QU</value>
	    <value>IQUV</value>
	    <value>RR</value>
	    <value>LL</value>
	    <value>RRLL</value>
	    <value>XX</value>
	    <value>YY</value>
	    <value>XXYY</value>
    </allowed>
    </param>

    <param type="string" name="field">
    <description>Field Name</description>
    <value></value>
    </param>

    <param type="any" name="spw">
	    <description>Spectral windows:channels: \'\' is all </description>
	    <any type="variant"/>
	    <value type="string"></value>
    </param>

    <constraints>
         <when param="mode">
            <equals value="mfs"/>
            <equals value="channel">
               <default param="nchan"><value>1</value></default>
               <default param="start"><value>0</value>
               <description>first input channel to use</description>
               </default>
               <default param="width"><value>1</value></default>
            </equals>
            <equals value="velocity">
               <default param="nchan"><value>1</value></default>
               <default param="start"><value type="string">0.0km/s</value>
                  <description>Velocity of first image channel: e.g \'0.0km/s\'</description>
               </default>
               <default param="width"><value type="string">1km/s</value>
                  <description>image channel width in velocity units: e.g \'-1.0km/s\'</description>
               </default>
            </equals>
            <equals value="frequency">
               <default param="nchan"><value>1</value></default>
               <default param="start"><value type="string">1.4GHz</value>
                  <description>Frequency of first image channel: e.q. \'1.4GHz\'</description>
               </default>
               <default param="width"><value type="string">10kHz</value>
                  <description>Image channel width in frequency units: e.g \'1.0kHz\'</description>
               </default>
            </equals>
         </when>
    </constraints>
	</input>
<returns type="void"/>

<example>

        The mask image must be consistent with a particular visibility file and source
        selection; hence the need to specify the imaging parameters and source
        selection.

        If the source image has already been made, then a mask image can be made by:
 
                 Load the image into the viewer
                 click on tools (top just left of center)
                 click on Region Manager
                 make  rectangular and/or polygon areas as needed 
                 save as region file
                 This region file can substitute as a mask in most application.

        You can also use taskname='clean' with interactive = T to make a mask when the
        dirty image is produced.
                 

	Keyword arguments:
        cleanbox -- Cleaning region:
                default: [] defaults to inner quarter of image
                Two specification types:
                Explicit pixel ranges
                   example: cleanbox=[[110,110,150,145],[180,70,190,80]]
                   cleans two regions defined by the pixel ranges
                Filename with pixel values with ascii format:
                   &lt;fieldid blc-x blc-y trc-x trc-y&gt; on each line
	----------------------------------------------------------------
        vis -- Name of input visibility file
                default: none; example: vis='ngc5921.ms'
        imagename -- Name of output mask image
                default: none; example: imagename='ngc5921.mask'
        mode -- Type of selection 
                default: 'mfs'; example: mode='channel'; 
                Options: 'mfs', channel'
        nchan -- Number of channels to select
                default: -1 (all); example: nchan=45
        start -- Start channel
                default=0; example: start=5
        width -- Channel width (value &gt; 1 indicates channel averaging)
                default=1; example: width=5
        step -- Step in channel number
                default=1; example: step=2      
        imsize -- Image size in spatial pixels (x,y)
                default = [256,256]; example: imsize=[512,512]
        cell -- Cell size in arcseconds (x,y)
                default=[0,0] = none; example: cell=[0.5,0.5]
        phasecenter -- direction measure  or fieldid for the mosaic center
                default: '' (imply field=0 as center); example: phasecenter=6
                or phasecenter='J2000 19h30m00 -40d00m00'
        stokes -- Stokes parameters to image
                default='I'; example: stokes='IQUV'; 
                Options: 'I','IV','IQU','IQUV'
        field -- Select field using field id(s) or field name(s).
                  [run listobs to obtain the list id's or names]
                default: ''=all fields
                If field string is a non-negative integer, it is assumed a field index
                  otherwise, it is assumed a field name
                field='0~2'; field ids 0,1,2
                field='0,4,5~7'; field ids 0,4,5,6,7
                field='3C286,3C295'; field named 3C286 adn 3C295
                field = '3,4C*'; field id 3, all names starting with 4C
        spw -- Select spectral window/channels
                default: ''=all spectral windows and channels
                spw='0~2,4'; spectral windows 0,1,2,4 (all channels)
                spw='&lt;2';  spectral windows less than 2 (i.e. 0,1)
                spw='0:5~61'; spw 0, channels 5 to 61
                spw='0,10,3:3~45'; spw 0,10 all channels, spw 3, channels 3 to 45.
                spw='0~2:2~6'; spw 0,1,2 with channels 2 through 6 in each.
                spw='0:0~10;15~60'; spectral window 0 with channels 0-10,15-60
                spw='0:0~10,1:20~30,2:1;2;3'; spw 0, channels 0-10,
                   spw 1, channels 20-30, and spw 2, channels, 1,2 and 3

 </example>
 </task>
 </casaxml>
