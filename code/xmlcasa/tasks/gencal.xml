<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
      file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="gencal" category="calibration">
	<shortdescription>Externally specify calibration solutions of varous types</shortdescription>
	<description>

        Specify calibration externally.

	</description>
	<input>
		<param type="string" name="vis" mustexist="true">
			<description>Name of input visibility file</description>
			<value></value>
		</param>

		<param type="string" name="caltable">
			<description>The input/output calibration table</description>
			<value></value>
		</param>

		<param type="string" name="caltype">
			<description>The calibration type</description>
			<value></value>
                        <allowed kind="enum">
                            <value>amp</value>
                            <value>ph</value>
                            <value>sbd</value>
                            <value>mbd</value>
                            <value>antpos</value>
                            <value>antposvla</value>
                        </allowed>
		</param>

		<param type="string" name="spw">
			<description>Calibration spw(s) selection</description>
			<value></value>
		</param>
		<param type="string" name="antenna">
			<description>Calibraiton antenna(s) selection</description>
			<value></value>
		</param>
		<param type="string" name="pol">
			<description>Calibration polarizations(s) selection</description>
			<value></value>
		</param>

		<param type="doubleArray" name="parameter">
			<description>The calibration values</description>
			<value></value>
		</param>

	</input>
<returns type="void"/>

<example>

     The gencal task provides a means of specifying calibration manually.

     Currently, gain amplitude and phase, single- and multi-band delay,
     and antenna position corrections are supported.  Currently, only
     constant (in time) calibration specifications are supported.  As
     such, gencal should generally be run from scratch or on caltables
     it has already generated, and not on caltables generated by other
     tasks (e.g., gaincal), which may be time-dependent.  Time-dependent 
     corrections will be supported in gencal in future.

     gencal can be run with detailed spw, antenna, and pol selection with
     a long parameter list enumerating calibration values for the specified
     pols, antennas, and spws, or with a single parameter set to apply to
     all specified pols, antennas, and spws.  Alternatively, gencal can
     be run multiple times to introduce calibration values for different
     spws, antennas, and polarizations serially; in this case, the calibration
     values are applied cumulatively.  Spws, antennas, and/or pols that
     remain unspecified will assume nominal values.  A mechanism for
     specifying manual corrections via a text file (useful for a large
     number of calibration values) will be provided in the future.

     When specifying a long list of calibration parameter values, these
     should be ordered first (fastest) by pol (if pol!=''), then by
     antenna (if antenna!=''), and finally (sloweset) by spw (if spw!='').  
     Unspecified selection axes (one or more of spw, antenna, pol are '') 
     must not be enumerated in the parameter list; the parameter 
     specification will be duplicated on unspecified selection axes.  Thus, 
     if all selections axes are unspecified (i.e., spw='', antenna='', 
     and pol=''), only a single parameter set can be specified, and it will 
     be applied to all pols, antennas, spws.  Note that not all calibration 
     types support all selection options, e.g., antenna position corrections 
     (caltype='antpos') are not spw- or pol-dependent.  In such cases, the 
     irrelevant selection axis specifications will be ignored.

     For ordinary antenna position corrections (caltype='antpos'), it is 
     expected that the antenna position offsets will be specified in the
     ITRF frame.  For old-fashioned VLA position corrections (in the VLA-centric
     frame), use caltype='antposvla', and gencal will rotate them automatically
     to ITRF before (cumulatively) storing them in the output caltable.

     Keyword arguments:

     vis -- Name of input visibility file
             default: none.  example: vis='ngc5921.ms'
     caltable -- Name of input/output caltable.  If it does not
                  exist, it will be created from scratch.  Specifying
                  an existing table will result in the specified parameters
                  being applied cumulatively.  Currently, only input
                  caltables with a single timestamp are supported.
                  default: none.  example: caltable='test.G'
     caltype -- The calibration parameter type being specified.
                 Options include:
                 'amp' = gain (G) amplitude (1 real parameter per
                         pol, antenna, spw)
                 'ph'  = gain (G) phase (deg) (1 real parameter per
                         pol, antenna, spw)
                 'sbd' = single-band delays (nsec) (1 real parameter 
                         per pol, antenna, spw)
                 'mbd' = multi-band delay (nsec) (1 real parameter 
                         per pol, antenna, spw)
                 'antpos' = antenna position corrections (m) (3 real
                            ITRF offset parameters per antenna; spw, pol
                            selection will be ignored)
                 'antposvla' = antenna position corrections specified
                               in the old VLA-centric coordinate system
                 default: none.
                 example: caltype='ph'
     spw -- Spectral window selection for specified parameters. 
             default: spw='' (specified parameters apply to all spws)
             example: spw = '2,3,4'
     antenna -- Antenna selection for specified parameters. 
                 default: antenna='' (specified parameters apply to all antennas)
                 example: antenna='EA02, EA03' (specified parameter(s) to
                           apply to EA02 and EA03 only)
     pol -- Polarization selection for specified parameters.
             default: pol='' (specified parameters apply to all polarizations)
             example: pol='R' (specified parameters to apply to
                                 R only)
     parameter -- The calibration parameters, specified as a list, to 
                   store in caltable for the spw, antenna, and pol 
                   selection.  The required length of the list is 
                   determined by the caltype and the spw, antenna, pol
                   selection.  One "set" of parameters (e.g., one value
                   for 'amp', 'ph', etc., three values for 'antpos') may 
                   be specified for all specified spw, antenna, and pol.
                   OR, parameters should be enumerated for all pol, antenna, 
                   and spw specified.  When enumerating over multiple pols,
                   antennas and spws, enumerate pols fastest and spws slowest.
                   See examples.
      
     Examples:

       gencal(vis='test.ms',caltable='test.G',caltype='amp',
              spw='',antenna='',pol='',
              parameter=[10])

         --> Gain solution amplitude for all spws, antennas, 
              and polarizations will be scaled by 10

       gencal(vis='test.ms',caltable='test.G',caltype='ph',
              spw='',antenna='EA03,EA04',pol='',
              parameter=[45,120])

         --> Gain solutions phases for antennas EA03 and EA04
              will be adjusted (additive) by 45 and 120 
              degrees (respectively), for all spws and polarizations

       gencal(vis='test.ms',caltable='test.G',caltype='ph',
              spw='',antenna='EA05,EA06',pol='R',
              parameter=[63,-34])

         --> Gain solutions phases for antennas EA05 and EA06
              will be adjusted (additive) by 63 and -34 
              degrees (respectively), in R only, for all spws

       gencal(vis='test.ms',caltable='test.G',caltype='ph',
              spw='',antenna='EA09,EA10',pol='R,L',
              parameter=[14,-23,-130,145])

         --> Gain solutions phases in all spws will be adjusted for 
              antenna EA09 by 14 deg in R and -23 deg in L, and for
              antenna EA10 by -130 deg in R and 145 deg in L.

       gencal(vis='test.ms',caltable='test.G',caltype='ph',
              spw='2,3',antenna='EA09,EA10',pol='',
              parameter=[14,-23,-130,145])

         --> Gain solutions phases in both polarizations will be adjusted for 
              antenna EA09 by 14 deg in spw 2 and -23 deg in spw 3, and for
              antenna EA10 by -130 deg in spw 2 and 145 deg in spw 3.

       gencal(vis='test.ms',caltable='test.G',caltype='sbd',
              spw='2,3',antenna='EA09,EA10',pol='',
              parameter=[14,-23,-130,145])

         --> Delay solutions in both polarizations will be adjusted for 
              antenna EA09 by 14 nsec in spw 2 and -23 nsec in spw 3, and for
              antenna EA10 by -130 nsec in spw 2 and 145 nsec in spw 3.

       gencal(vis='test.ms',caltable='test.G',caltype='antpos',
              antenna='EA09,EA10',
              parameter=[0.01,0.02,0.03, -0.03,-0.01,-0.02])

         --> Antenna position corrections (in ITRF) will be introduced for
              antenna EA09 (dBx=0.01, dBy=0.02, dBz=0.03) and for
              antenna EA10 (dBx=-0.03, dBy=-0.01, dBz=-0.02)

       gencal(vis='test.ms',caltable='test.G',caltype='antposvla',
              antenna='EA09,EA10',
              parameter=[0.01,0.02,0.03, -0.03,-0.01,-0.02])

         --> Antenna position corrections (in the traditional VLA-centric
              frame) will be introduced for
              antenna EA09 (dBx=0.01, dBy=0.02, dBz=0.03) and for
              antenna EA10 (dBx=-0.03, dBy=-0.01, dBz=-0.02)
              These offsets will be rotated to the ITRF frame before
              storing them in the caltable.

 </example>
 </task>
 </casaxml>

